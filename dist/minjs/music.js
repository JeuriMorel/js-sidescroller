import{isPaused as e}from"./app.js";import{qs as t}from"./utils.js";export default class h{constructor(e){this.game=e,this.themes={main:t("#main_theme"),forest:t("#forest_theme"),boss:t("#boss_theme")},this.themeTimer=0,this.themeInterval=200,this.forestThemeFadeOutPoint=this.themes.forest.duration-5,this.themes.forest.dataset.fadeOut=this.themes.forest.duration-5,this.themes.forest.addEventListener("ended",(()=>{this.currentTheme=this.themes.main,this.currentTheme.play()})),this.themes.main.addEventListener("timeupdate",(()=>{this.themes.main.currentTime>this.themes.main.duration-.3&&(this.themes.main.currentTime=42,this.themes.main.play())})),this.themes.main.volume=.1,this.themes.boss.volume=.1,this.themes.forest.volume=1,this.currentTheme=this.themes.forest}toggleMusicPlayback(){e?this.currentTheme?.pause():this.currentTheme?.play()}fadeOutTheme(e,t){!e.paused&&e.volume>.2&&e.currentTime>=e.dataset.fadeOut&&!e.ended&&(this.themeTimer>this.themeInterval?(e.volume-=.1,this.themeTimer=0):this.themeTimer+=t)}update(e){null!=this.currentTheme&&(this.currentTheme.loop||this.fadeOutTheme(this.currentTheme,e),this.currentTheme.loop&&!this.currentTheme.paused&&!this.currentTheme.ended&&this.currentTheme.currentTime>0&&this.currentTheme.volume<1&&(this.themeTimer>this.themeInterval?(this.currentTheme.volume=Math.min(this.currentTheme.volume+.01,1),this.themeTimer=0):this.themeTimer+=e))}}